var firstname,fullname,where,reason,avatarImageSrc,variantNumber,imgs=[],imagesOK=0,imageURLs=[];const AVATAR=0,RECT=1,SQUARE=2,PROFILE=3,OR_RED="#ef3e40",OR_BLUE="#0c57a2",prepareFontLoad=e=>Promise.all(e.map((e=>document.fonts.load(e))));async function startGeneratingImage(){jQuery("#generate").prop("disabled",!0),jQuery(".placeholder").hide();await prepareFontLoad(["400 60px Poppins","800 60px Poppins"]),imgs=[],(imageURLs=[]).push(avatarImageSrc||"img/avatar.png"),imageURLs.push("img/rect-template.png"),imageURLs.push("img/square-template"+variantNumber+".png"),imageURLs.push("img/profile-template.png"),imagesOK=0,startLoadingAllImages(imagesAreNowLoaded)}function wordWrap(e,t,a,r,n){var i=e.split(/(\s+)/),s=[],l=0,o=0,d="",g=0,m=r?"-":"",u=a.measureText(m).width,h=0;if(a.measureText("M"+n+m).width>t)return[];for(var f=0,c=i.length;f<c;f++)if(l=a.measureText(i[f].replace(/\s+$/,"")).width+n*i[f].length,o=a.measureText(i[f]).width+n*i[f].length,g+l<t)d+=i[f],g+=o;else if(l<t)s.push(d),d=i[f],g=o;else for(var p=0,w=i[f].length;p<w;p++){if(h=a.measureText(i[f][p]).width+n,!i[f][p+1]||!/\S/.test(i[f][p+1])){g+h<t?(d+=i[f].substr(p),g+=a.measureText(i[f].substr(p)).width+n*i[f].substr(p).length):(d+=m,s.push(d),d=i[f].substr(p),g=a.measureText(i[f].substr(p)).width+n*i[f].substr(p).length);break}g+h+u<t?(d+=i[f][p],g+=h):(d+=m,s.push(d),d=i[f][p],g=h)}s.push(d);for(var x=0,v=s.length;x<v;x++)s[x]=s[x].replace(/\s+$/,"");return s}function deUnderline(e){return e.replace("_"," ")}function wrapText(e,t,a,r,n,i,s=0,l=!1){var o=wordWrap(t,n,e,!0,s);if(!l)for(var d=0,g=o.length;d<g;d++){var m=o[d];if(0===s)e.fillText(deUnderline(m),a,r+i*d);else{var u,h=e.measureText(m).width+s*(m.length-1);switch(e.textAlign){case"center":u=a-h/2;break;case"right":u=a-h;break;default:u=a}var f=e.textAlign;e.textAlign="left";for(var c=0;c<m.length;c++)e.fillText(deUnderline(m[c]),u,r+i*d),u+=s+e.measureText(m[c]).width;e.textAlign=f}}return i*o.length}function startLoadingAllImages(e){for(var t=0;t<imageURLs.length;t++){var a=new Image;imgs.push(a),a.onload=function(){++imagesOK>=imageURLs.length&&e()},a.onerror=function(){alert("image #"+t+" load failed: "+imageURLs[t]),jQuery("#generate").prop("disabled",!1)},a.src=imageURLs[t]}}function imagesAreNowLoaded(){drawRect(),drawSquare(),drawProfile(),jQuery("#generate").prop("disabled",!1),jQuery(".initiallyHidden").show(),jQuery(".placeholder").hide()}function drawCircledAvatar(e,t,a,r){var n=e.getContext("2d"),i=(e.width,t+r/2),s=(a=e.height-(a+r))+r/2,l=r,o=r;const d=l/o;n.save(),n.beginPath(),n.arc(i,s,r/2,0,2*Math.PI),n.clip();var g=imgs[0],m=g.naturalWidth/g.naturalHeight;m>d?n.drawImage(g,i-o*m/2,s-o/2,o*m,o):n.drawImage(g,i-l/2,s-l/m/2,l,l/m),n.restore()}function drawPortraitAvatar(e,t,a,r,n){var i=e.getContext("2d"),s=e.width,l=e.height,o=t+r/2,d=a+n/2;const g=r/n;i.save(),i.beginPath(),i.rect(t,a,r,n),i.clip(),i.fillStyle="green",i.fillRect(0,0,s,l);var m=imgs[0],u=m.naturalWidth/m.naturalHeight;i.fillRect(o-r/2,d-r/u/2,r,r/u),u>g?i.drawImage(m,o-n*u/2,d-n/2,n*u,n):i.drawImage(m,o-r/2,d-r/u/2,r,r/u),i.restore()}function drawSquareNameLine(e,t,a,r,n){var i=e.getContext("2d"),s=e.width,l=e.height-a,o=s;i.textAlign="left";for(var d=n;d>12&&(i.font="800 "+String(d)+"px Poppins, sans-serif",!(t+(o=i.measureText(r).width)<s-d));d-=1);l+=i.measureText(r).fontBoundingBoxDescent,i.fillStyle=OR_RED,i.fillRect(0,l-i.measureText(r).fontBoundingBoxAscent,o+t+d/2,i.measureText(r).fontBoundingBoxAscent+i.measureText(r).fontBoundingBoxDescent),i.fillStyle="white",i.font="800 "+String(d)+"px Poppins, sans-serif",i.fillText(r,t,l)}function drawRectNameLine(e,t,a,r,n){var i=e.getContext("2d"),s=e.width,l=e.height-a;i.textAlign="center";for(var o=n;o>12&&(i.font="800 "+String(o)+"px Poppins, sans-serif",!(i.measureText(r).width<s-24));o-=1);l-=52-o,i.fillStyle="white",i.font="800 "+String(o)+"px Poppins, sans-serif",i.fillText(r,t,l)}function drawRectNameWhereLine(e,t,a,r,n){var i=e.getContext("2d"),s=e.width,l=e.height-a,o=s;i.textAlign="right";for(var d=r;d>12&&(i.font="400 "+String(d)+"px Poppins, sans-serif",!(t+(o=i.measureText(n).width)<s-d));d-=1);i.fillStyle=OR_RED;var g=o+d;g=Math.max(g,294),i.fillRect(s-g,l-i.measureText(n).fontBoundingBoxAscent,g,i.measureText(n).fontBoundingBoxAscent+i.measureText(n).fontBoundingBoxDescent),i.fillStyle="white",i.font="400 "+String(d)+"px Poppins, sans-serif",i.fillText(n,s-d/2,l)}function drawWhyLines(e,t,a,r,n,i,s=0,l=1.45){r="“"+r+"”";var o=e.getContext("2d"),d=e.width,g=e.height-a;o.textAlign="left",o.fillStyle="white";for(var m=n;m>10;m-=1){o.font="800 "+String(m)+"px Poppins,sans-serif",textWidth=s||d-2*t;var u=wrapText(o,r,0,0,textWidth,m*l,0,!0);if(u<i)break}o.font="800 "+String(m)+"px Poppins,sans-serif";wrapText(o,r,t,g-u/2+m,textWidth,m*l,0)}function drawSquare(){var e=document.getElementById("squareCanvas"),t=e.getContext("2d"),a=e.width,r=e.height;t.clearRect(0,0,a,r);var n=imgs[2];t.drawImage(n,0,0,a,r),drawCircledAvatar(e,45,643,402),drawSquareNameLine(e,75,629,fullname.trim()+", "+where,28),drawWhyLines(e,70,275,reason,80,230),document.getElementById("squareImg").style.display="none";var i=e.toDataURL();document.getElementById("squareResult").src=i}function drawRect(){var e=document.getElementById("rectCanvas"),t=e.getContext("2d"),a=e.width,r=e.height;t.clearRect(0,0,a,r);var n=imgs[1];t.drawImage(n,0,0,a,r),drawPortraitAvatar(e,916,132,275,345),drawRectNameLine(e,a/2,543,firstname.trim().toUpperCase()+" ENDORSES NINA TURNER FOR CONGRESS",54),drawRectNameWhereLine(e,450,134,30,fullname+", "+where),drawWhyLines(e,435,330,reason,50,300,464,1.25),document.getElementById("rectImg").style.display="none";var i=e.toDataURL();document.getElementById("rectResult").src=i}function drawProfile(){var e=document.getElementById("iconCanvas"),t=e.getContext("2d"),a=e.width,r=e.height,n=.8*a,i=(a-n)/2;drawCircledAvatar(e,i,i,n),image=imgs[3],t.drawImage(image,0,0,a,r),document.getElementById("iconImg").style.display="none";var s=e.toDataURL(),l=document.getElementById("iconResult");l.src=s,l.title="I-Endorse-Nina-profile.png"}